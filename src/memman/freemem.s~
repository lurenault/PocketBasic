	;; Calcolo della memoria libera

MMFREE:
	;; INPUT: -
	;; OUTPUT: x,y=Memoria libera (low-high order)
	;; 	   Carry= set se MEMTOP è minore di MEMBOTTOM
	
	ldy	MEMTOP+1	; Se MEMTOP < MEMBOTTOM esce con il carry settato
	cpy	MEMBOTTOM+1
	bcc	@exiterr

	ldx	MEMTOP
	cpx	MEMBOTTOM
	bcs	@do
@exiterr:
	sec
	rts
@do:
	pha			; Salva il contenuto del registro A
	
	txa			; X contiene MEMTOP
	;; Il carry è già settato dal confronto tra MEMTOP e MEMBOTTOM
	sbc	MEMBOTTOM
	sta	MMTEMPP1
	tya			; Y contiene MEMTOP+1
	sbc	MEMBOTTOM+1
	sta	MMTEMPP1+1

	lda	FIRSTENTRY	; Imposta la variabile in esamine come la prima
	sta	CURRVAR
	lda	FIRSTENTRY+1
	sta	CURRVAR+1

	lda	CURRVAR		; Se il puntatore alla variabile corrente è nullo, abbiamo terminato.
	ora	CURRVAR+1
	beq	@exit

	lda	#

@exit:
	ldx	MMTEMPP1	; In output abbiamo la memoria disponibile
	ldy	MMTEMPP1+1
	pla
	clc
	rts
